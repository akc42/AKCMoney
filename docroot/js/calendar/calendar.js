Calendar=function(){var d=false;var c=false;var b;var a=document.getElements("script");a.every(function(h){var i=h.src.substr(h.src.length-11);if(i==="calendar.js"){b=h.src.substr(0,h.src.length-2)+"html";return false}return true});var e=new Element("div");var g=new Chain();var f=function(l,k){var j=k.bind(l);function i(){j(e.clone(true,true))}if(d){j(e.clone(true,true));g.callChain();return true}if(!c){var h=new Request({url:b,onSuccess:function(m){e.set("html",m);d=true;g.callChain()},onFailure:function(n){var m=0}});h.get();c=true}g.chain(i);return false};return{Single:new Class({Implements:[Events,Options],options:{classes:[],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],draggable:true,end:new Date(Date.UTC(2999,11,31,23,59,59,999)),format:"d-M-y",months:["January","February","March","April","May","June","July","August","September","October","November","December"],offset:0,onHideStart:Class.empty,onHideComplete:Class.empty,onShowStart:Class.empty,onShowComplete:Class.empty,onUpdate:Class.empty,start:new Date(Date.UTC(1000,0,1)),tweak:{x:8,y:-180},width:"70px"},initialize:function(i,j){var k;var h;var l;this.setOptions(j);if(typeOf(i)!="element"){return false}if(i.get("tag")!="input"){return false}if(i.type!="hidden"){return false}this.input=i;if(i.value===""){this.input.value="0"}k=["calendar","picker","prev","next","nav","month","year","today","invalid","valid","inactive","active","hover","hilite"];h=k.map(function(n,m){if(this.options.classes[m]){if(this.options.classes[m].length){n=this.options.classes[m]}}return n},this);this.options.classes=h.associate(k);l=i.getParent();this.button=new Element("button",{type:"button","class":this.options.classes.calendar}).inject(l);this.span=new Element("span",{"class":this.options.classes.calendar}).inject(l);this.visible=false;this.picker=new Element("div",{styles:{left:"-1000px",opacity:0,position:"absolute",top:"-1000px",zIndex:1000}}).addClass(this.options.classes.picker).inject(document.body);if(window.ie6){this.iframe=new Element("iframe",{styles:{left:"-1000px",position:"absolute",top:"-1000px",zIndex:999}}).inject(document.body);this.iframe.style.filter="progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)"}this.fx=new Fx.Tween(this.picker,{onStart:function(){if(this.picker.getStyle("opacity")==0){if(window.ie6){this.iframe.setStyle("display","block")}this.picker.setStyle("display","block");this.fireEvent("showStart",this)}else{this.fireEvent("hideStart",this)}}.bind(this),onComplete:function(){if(this.picker.getStyle("opacity")==0){this.picker.setStyle("display","none");if(window.ie6){this.iframe.setStyle("display","none")}this.fireEvent("hideComplete",this)}else{this.fireEvent("showComplete",this)}}.bind(this)});if(this.options.draggable){this.drag=new Drag.Move(this.picker,{onDrag:function(){if(window.ie6){this.iframe.setStyles({left:this.calendar.style.left,top:this.calendar.style.top})}}.bind(this)})}this.setStart(this.options.start);this.setEnd(this.options.end);this.resetVal();this.picker.empty();f(this,function(s){var A;var r;var w,u;var z;var n;var p;var t,m,v,o;var q=this;s.inject(this.picker);this.button.addEvent("click",function(x){x.stop();q.toggle()});A=window.getScrollSize();r=this.button.getCoordinates();w=r.right+this.options.tweak.x;u=r.top+this.options.tweak.y;if(!this.picker.coord){this.picker.coord=this.picker.getCoordinates()}if(w+this.picker.coord.width>A.x){w-=(w+this.picker.coord.width-A.x)}if(u+this.picker.coord.height>A.y){u-=(u+this.picker.coord.height-A.y)}this.picker.setStyles({left:w+"px",top:u+"px"});if(window.ie6){this.iframe.setStyles({height:this.picker.coord.height+"px",left:w+"px",top:u+"px",width:this.picker.coord.width+"px"})}z=s.getElement("table");z.getElements("th").each(function(y,x){var B=this.options.days[(x+this.options.offset)%7];y.empty();y.appendText(B.substr(0,1));y.set("title",B);y.getNext()},this);n=s.getElements("."+this.options.classes.prev);n.each(function(x){if(x.hasClass(this.options.classes.nav)){this.navprevyear=x;x.removeClass(this.options.classes.nav)}else{this.navprevmonth=x}x.removeClass(this.options.classes.prev)},this);n=s.getElements("."+this.options.classes.next);n.each(function(x){if(x.hasClass(this.options.classes.nav)){this.navnextyear=x;x.removeClass(this.options.classes.nav)}else{this.navnextmonth=x}x.removeClass(this.options.classes.next)},this);this.days=z.getElements("td")})},resetVal:function(){var h=new Date();h.setTime(this.input.value.toInt()*1000);this.date=h.getDate();this.span.set("text",this.format(h));this.month=h.getMonth();this.year=h.getFullYear()},setVal:function(){var h=new Date(this.year,this.month,this.date,12,0,0,0);if(h<this.getStart()){h=this.getStart()}else{if(h>this.getEnd()){h=this.getEnd()}}this.input.value=h.getTime()/1000;this.span.set("text",this.format(h));this.fireEvent("update")},getStart:function(){return(this.start)?this.start:new Date()},setStart:function(h){this.start=(h)?((this.options.start)?((h>this.options.start)?h:this.options.start):(h>new Date())?h:new Date()):((this.options.start)?((this.options.start>new Date())?this.options.start:null):null);if(this.input.value.toInt()<this.getStart().getTime()/1000){this.input.value=this.getStart().getTime()/1000}},getEnd:function(){return(this.end)?this.end:new Date()},setEnd:function(h){this.end=(h)?((this.options.end)?((h<this.options.end)?h:this.options.end):(h<new Date())?h:new Date()):((this.options.end)?((this.options.end<new Date())?this.options.end:null):null);if(this.input.value.toInt()>this.getEnd().getTime()/1000){this.input.value=this.getEnd().getTime()/1000}},toggle:function(){if(this.visible){document.removeEvent("mousedown",this.hide);this.fx.start("opacity",1,0);this.visible=false}else{document.removeEvent("mousedown",this.hide);var h=this;this.hide=function(j){var i;i=new Event(j).target;while(i!==document.body&&i.nodeType===1){if(i===h.picker||i===h.button){j.stop;return false}i=i.parentNode}h.toggle();return true};document.addEvent("mousedown",this.hide);this.newMorY();this.fx.start("opacity",0,1);this.visible=true}},newMorY:function(){var o;var k;var m,h;var p;var j,n;var l=this;this.picker.addClass(this.options.months[this.month].toLowerCase());this.picker.getElement(".month").empty().appendText(this.options.months[this.month]);this.picker.getElement(".year").empty().appendText(this.year);if(this.navprevyear){this.navprevyear.removeEvents().removeClass(this.options.classes.prev);if(this.year!==this.getStart().getFullYear()){this.navprevyear.addClass(this.options.classes.prev).addEvent("click",function(i){i.stop();l.year--;l.setVal();l.newMorY()})}}if(this.navnextyear){this.navnextyear.removeEvents().removeClass(this.options.classes.next);if(this.year!==this.getEnd().getFullYear()){this.navnextyear.addClass(this.options.classes.next).addEvent("click",function(i){i.stop();l.year++;l.setVal();l.newMorY()})}}this.navprevmonth.removeEvents().removeClass(this.options.classes.prev);if(this.year!==this.getStart().getFullYear()||this.month!==this.getStart().getMonth()){this.navprevmonth.addEvent("click",function(i){i.stop();l.picker.removeClass(this.options.months[this.month].toLowerCase());l.month--;if(l.month<0){l.month=11;l.year--}l.setVal();l.newMorY()}).addClass(this.options.classes.prev)}this.navnextmonth.removeEvents().removeClass(this.options.classes.next);if(this.year!==this.getEnd().getFullYear()||this.month!==this.getEnd().getMonth()){this.navnextmonth.addEvent("click",function(i){i.stop();l.picker.removeClass(this.options.months[this.month].toLowerCase());l.month++;if(l.month>11){l.month=0;l.year++}l.setVal();l.newMorY()}).addClass(this.options.classes.next)}o=((new Date(this.year,this.month,1).getDay()-this.options.offset)+7)%7;n=new Date();if(this.year==n.getFullYear()&&this.month==n.getMonth()){j=n.getDate()-1+o}for(k=0;k<42;k++){m=new Date(this.year,this.month,k-o+1);h=new Date(m);m.setHours(0,0,0,0);h.setHours(23,59,59,999);p=this.days[k];p.empty().appendText(m.getDate()).removeEvents().removeClass(this.options.classes.valid).removeClass(this.options.classes.invalid).removeClass(this.options.classes.active).removeClass(this.options.classes.today);if(this.getStart()>h){p.addClass(this.options.classes.invalid)}else{if(this.getEnd()<m){p.addClass(this.options.classes.invalid)}else{if(m.getMonth()===this.month){p.addClass(this.options.classes.valid);if(j===k){p.addClass(this.options.classes.today)}p.store("i",k);if(this.date===k-o+1){p.addClass(this.options.classes.active)}p.addEvent("click",function(r){var q;r.stop();q=this.retrieve("i");if(l.date>=0){l.days[l.date-1+o].removeClass(l.options.classes.active)}l.date=q-o+1;this.addClass(l.options.classes.active);l.setVal()})}}}}},format:function(m){var t="";if(m){var p=m.getDate();var x=m.getDay();var o=this.options.days[x];var k=m.getMonth()+1;var s=this.options.months[k-1];var u=m.getFullYear()+"";var r=m.getHours();var v=this.options.format;var q;for(q=0,len=v.length;q<len;q++){var i=v.charAt(q);switch(i){case"y":u=u.substr(2);case"Y":t+=u;break;case"m":if(k<10){k="0"+k}case"n":t+=k;break;case"M":s=s.substr(0,3);case"F":t+=s;break;case"d":if(p<10){p="0"+p}case"j":t+=p;break;case"D":o=o.substr(0,3);case"l":t+=o;break;case"N":x+=1;case"w":t+=x;break;case"S":if(p%10==1&&p!="11"){t+="st"}else{if(p%10==2&&p!="12"){t+="nd"}else{if(p%10==3&&p!="13"){t+="rd"}else{t+="th"}}}break;default:t+=i}}}return t},destroy:function(){this.picker.destroy();this.input.dispose();this.input.inject(this.button.getParent());this.button.destroy()}})}}();